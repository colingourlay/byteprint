(function(a){if(!a||!(a.toJSON||Object.toJSON||window.JSON)){throw new Error("jQuery, MooTools or Prototype needs to be loaded before jStorage!")}a.jStorage={version:"0.1.2",_storage:{},_storage_service:{jStorage:"{}"},_storage_elm:null,json_encode:a.toJSON||Object.toJSON||(window.JSON&&JSON.encode),json_decode:a.evalJSON||(window.JSON&&JSON.decode)||function(b){return String(b).evalJSON()},_init:function(){var c;if("localStorage" in window){this._storage_service=window.localStorage}else{if("globalStorage" in window){this._storage_service=window.globalStorage[document.domain]}else{this._storage_elm=document.createElement("link");if("addBehavior" in this._storage_elm){this._storage_elm.style.behavior="url(#default#userData)";document.getElementsByTagName("head")[0].appendChild(this._storage_elm);this._storage_elm.load("jStorage");try{c=this._storage_elm.getAttribute("jStorage")}catch(b){c="{}"}if(c&&c.length){this._storage_service.jStorage=c}}else{this._storage_elm=null;return}}}if("jStorage" in this._storage_service&&this._storage_service.jStorage){try{this._storage=this.json_decode(this._storage_service.jStorage)}catch(d){this._storage_service.jStorage="{}"}}else{this._storage_service.jStorage="{}"}},_save:function(){if(this._storage_service){try{this._storage_service.jStorage=this.json_encode(this._storage)}catch(c){}if(this._storage_elm){try{this._storage_elm.setAttribute("jStorage",this._storage_service.jStorage);this._storage_elm.save("jStorage")}catch(b){}}}},_checkKey:function(b){if(!b||(typeof b!="string"&&typeof b!="number")){throw new TypeError("Key name must be string or numeric")}return true},set:function(b,c){this._checkKey(b);this._storage[b]=c;this._save();return c},get:function(b,c){this._checkKey(b);if(b in this._storage){return this._storage[b]}return c?c:null},deleteKey:function(b){this._checkKey(b);if(b in this._storage){delete this._storage[b];this._save();return true}return false},flush:function(){this._storage={};this._save();return true}};a.jStorage._init()})(typeof jQuery!="undefined"&&jQuery||$);